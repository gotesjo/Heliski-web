YUI.add("prepare-print-modal-view",(function(e,r){require("hermes-core/flog")(r);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){},buildContainer:function(){this.setContainerWithTemplate("prepare-print-modal")},activate:function(){var e=this,r=this.get("container");this.contentContainer=r.one(".prepare-print-modal-container"),this.loadingContainer=r.one(".loading-container"),this.errorContainer=r.one(".error-container"),this.errorTextContainer=this.errorContainer.one(".error-message"),this.errorRetryButton=this.errorContainer.one("button.retry-button"),this.errorCancelButton=this.errorContainer.one("button.cancel-button"),this.registerEventHandler(this.errorRetryButton.on("click",(function(){e.fire("retryClicked")}))),this.registerEventHandler(this.errorCancelButton.on("click",(function(){e.fire("closeClicked")})))},showError:function(e){this.contentContainer.removeClass("loading"),this.contentContainer.addClass("error"),e&&this.errorTextContainer.set("text",e)},showLoading:function(){this.contentContainer.addClass("loading"),this.contentContainer.removeClass("error")}})}),"@VERSION@",{requires:["flickr-view","hermes-template-prepare-print-modal"],optionalRequires:["hermes-core"],langBundles:["common","prints"]});YUI.add("print-button-view",(function(t,i){require("hermes-core/flog")(i);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.disableClicks=i.disableClicks,this.iconSize=void 0!==i.iconSize?i.iconSize:"normal",this.photoPrintsHelper=new t.PhotoPrintsHelper(this.appContext),this.selectors={printButton:".print-button-container .print-button",newLabel:".print-button-container .label-beta"}},loadState:function(){var t=this;return this.appContext.getModel("photo-models",this.params.photoId).then((function(i){t.photoModel=i}))},buildContainer:function(){this.setContainerWithTemplate("print-button",{iconSize:this.iconSize})},activate:function(){var t=this.get("container");this.printButtonNode=t.one(this.selectors.printButton),this.printNewLabelNode=t.one(this.selectors.newLabel),this.disableClicks||(this.printButtonNode&&this.registerEventHandler(this.printButtonNode.on("click",this.handlePrintClick.bind(this))),this.printNewLabelNode&&this.registerEventHandler(this.printNewLabelNode.on("click",this.showPrintTooltip.bind(this))))},handlePrintClick:function(){"en-us"===this.appContext.lang.toLowerCase()?this.preparePrint():this.showEnglishWarningModal()},preparePrint:function(){var i=this;this.showPreparingPrintModal(),this.photoPrintsHelper.registerPrint(this.photoModel,t.config.win.location.href).then((function(i){t.config.win.location.href=i.redirectURL})).catch((function(t){i.preparePrintModalSubview.showError(t.message||i.intlMessage({intlName:"prints.SOMETHING_WRONG_PREPARING_PRINT"}))}))},showEnglishWarningModal:function(i){var e=this;this.englishWarningModal=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,showActionButton:!0,actionButtonLabel:this.intlMessage({intlName:"prints.CONTINUE_IN_ENGLISH"}),showCancelButton:!0,cancelButtonLabel:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"common.GO_BACK_BUTTON"}):this.intlMessage({intlName:"common.CANCEL"}),showCancelX:!1,showHeader:!0,showFooter:!0,title:this.intlMessage({intlName:"prints.ENGLISH_LANGUAGE_AHEAD"}),htmlMessage:this.intlMessage({intlName:"prints.ORDERING_IS_ENGLISH_ONLY"})}),this.englishWarningModal.show(),this.englishWarningModal.on("actionClick",(function(){e.englishWarningModal.close(),setTimeout((function(){e.preparePrint()}),0)}))},showPreparingPrintModal:function(){var i=this;this.preparePrintModalSubview=new t.Views["prepare-print-modal-view"]({appContext:this.appContext}),this.preparingPrintModal=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,subview:this.preparePrintModalSubview,hasSubviewConfigRefactor:!0}),this.preparingPrintModal.show(),this.preparePrintModalSubview.on("retryClicked",(function(){i.preparingPrintModal.close(),setTimeout((function(){i.preparePrint()}),0)})),this.preparePrintModalSubview.on("closeClicked",(function(){i.preparingPrintModal.close()}))},showPrintTooltip:function(){var i,e=this,n=this.printButtonNode;n&&(this.tooltip=new t.Views.FluidDroparound({appContext:this.appContext,htmlMessage:this.templates("print-icon-tooltip")({}),showDropArrow:!0,dismissOnOverlayClick:!0,observePageResize:!0,anchorElement:n,keyboardAnchorElement:n,minVerticalSpace:400,width:300,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetVertical:0}),i=this.tooltip.get("container"),this.registerEventHandler(i.delegate("click",(function(t){e.tooltip.close()}),".close-x-button")),this.tooltip.show())}})}),"@VERSION@",{requires:["flickr-view","hermes-template-print-button","hermes-template-print-icon-tooltip","prepare-print-modal-view","photo-prints-helper"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["common","prints"]});YUI.add("hermes-template-photo-page-download-interstitial",(function(t,n){var l=t.Template.Handlebars.revive({1:function(t,n,l,e,a){var s,i=null!=n?n:t.nullContext||{},o=t.hooks.helperMissing,r="function",c=t.escapeExpression,u=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t<div class="gift-pro-container">\n\t\t\t\t<div class="owner-avatar">\n\t\t\t\t\t<a class="avatar person medium"\n\t\t\t\t\t\trel="author"\n\t\t\t\t\t\thref="'+c(typeof(s=null!=(s=u(l,"pathAlias")||(null!=n?u(n,"pathAlias"):n))?s:o)===r?s.call(i,{name:"pathAlias",hash:{},data:a,loc:{start:{line:8,column:12},end:{line:8,column:25}}}):s)+'"\n\t\t\t\t\t\tdata-person-nsid="'+c(typeof(s=null!=(s=u(l,"nsid")||(null!=n?u(n,"nsid"):n))?s:o)===r?s.call(i,{name:"nsid",hash:{},data:a,loc:{start:{line:9,column:24},end:{line:9,column:32}}}):s)+'"\n\t\t\t\t\t\tstyle="background-image: url('+c(typeof(s=null!=(s=u(l,"buddyIcon")||(null!=n?u(n,"buddyIcon"):n))?s:o)===r?s.call(i,{name:"buddyIcon",hash:{},data:a,loc:{start:{line:10,column:35},end:{line:10,column:48}}}):s)+');"\n\t\t\t\t\t\ttabindex="0">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<p class="appreciation-title">\n\t\t\t\t\t'+c((u(l,"intlMessage")||n&&u(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{username:null!=n?u(n,"displayName"):n,intlName:"photo-page-scrappy.DOWNLOAD_MODAL_SAY_THX"},data:a,loc:{start:{line:15,column:5},end:{line:15,column:94}}}))+'\n\t\t\t\t</p>\n\t\t\t\t<p class="appreciation-body">\n\t\t\t\t\t'+c((u(l,"intlMessage")||n&&u(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{username:null!=n?u(n,"displayName"):n,intlName:"photo-page-scrappy.DOWNLOAD_MODAL_WHILE_GIFT"},data:a,loc:{start:{line:18,column:5},end:{line:18,column:97}}}))+'\n\t\t\t\t</p>\n\t\t\t\t<button class="butt">\n\t\t\t\t\t'+c((u(l,"outlet")||n&&u(n,"outlet")||o).call(i,null!=n?u(n,"gift-pro-view"):n,{name:"outlet",hash:{},data:a,loc:{start:{line:21,column:5},end:{line:21,column:29}}}))+"\n\t\t\t\t</button>\n\t\t\t</div>\n"},3:function(t,n,l,e,a){return'\t\t\t<div class="advertisement-container">\n\n\t\t\t</div>\n'},5:function(t,n,l,e,a){var s,i=null!=n?n:t.nullContext||{},o=t.hooks.helperMissing,r=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t<div class="buy-pro-container">\n\t\t\t\t<div class="flickr-pro-logo">\n\t\t\t\t\t<img class="logo" src="'+r("function"==typeof(s=null!=(s=c(l,"flickrProLogo")||(null!=n?c(n,"flickrProLogo"):n))?s:o)?s.call(i,{name:"flickrProLogo",hash:{},data:a,loc:{start:{line:33,column:28},end:{line:33,column:45}}}):s)+'">\n\t\t\t\t</div>\n\t\t\t\t<div class="ad-free">\n\t\t\t\t\t<p class="text">Ad free browsing</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="product-support">\n\t\t\t\t\t<p class="text">Premier product support</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="instant-download">\n\t\t\t\t\t<p class="text">Instant downloads</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="unlimited-backup">\n\t\t\t\t\t<p class="text">Unlimited backup at full resolution</p>\n\t\t\t\t</div>\n\t\t\t\t<button class="butt">\n\t\t\t\t\t'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{intlName:"common.GET_FLICKR_PRO"},data:a,loc:{start:{line:48,column:5},end:{line:48,column:57}}}))+"\n\t\t\t\t</button>\n\t\t\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,n,l,e,a){var s,i=null!=n?n:t.nullContext||{},o=t.hooks.helperMissing,r=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="download-interstitial-container">\n\t<div class="interstitial-upsell-container">\n'+(null!=(s=(c(l,"ifCond")||n&&c(n,"ifCond")||o).call(i,null!=n?c(n,"version"):n,"===","giftPro",{name:"ifCond",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:2},end:{line:24,column:13}}}))?s:"")+(null!=(s=(c(l,"ifCond")||n&&c(n,"ifCond")||o).call(i,null!=n?c(n,"version"):n,"===","ad",{name:"ifCond",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:25,column:2},end:{line:29,column:13}}}))?s:"")+(null!=(s=(c(l,"ifCond")||n&&c(n,"ifCond")||o).call(i,null!=n?c(n,"version"):n,"===","buyPro",{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:30,column:2},end:{line:51,column:13}}}))?s:"")+'\t</div>\n\t<div class="interstitial-text-container">\n\t\t<div class="title-container">\n\t\t\t<div class="progress-container">\n\t\t\t\t<div class="progress-text-container">\n\t\t\t\t\t<p class="text">\n\t\t\t\t\t\t'+r((c(l,"intlMessage")||n&&c(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.DOWNLOAD_MODAL_PREPARING_HEADER"},data:a,loc:{start:{line:58,column:6},end:{line:58,column:83}}}))+'\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="circular-progress-graph"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="licensing-attribution-container">\n\t\t\t<p class="text">\n\t\t\t\t'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{learnMoreUrl:null!=n?c(n,"learnMoreUrl"):n,license:null!=n?c(n,"license"):n,username:null!=n?c(n,"displayName"):n,intlName:"photo-page-scrappy.DOWNLOAD_MODAL_USER_PHOTO_LICENSE"},data:a,loc:{start:{line:66,column:4},end:{line:66,column:150}}}))+"\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</div>"},useData:!0}),e={};t.Array.each([],(function(n){var l=t.Template.get("hermes/"+n);l&&(e[n]=l)})),t.Template.register("hermes/photo-page-download-interstitial",(function(n,a){return(a=a||{}).partials=a.partials?t.merge(e,a.partials):e,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-page-download-interstitial-view",(function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,this.adTimerStartValue=e.config.flickr.moola.positions.interstitials[0].ad_timer_start_value,this.interStitialType,this.photoId=t.photoId,this.ownerNsid=t.nsid,this.setInterStitialType(),this},subviewConfig:{"gift-pro-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){let t=this;return e.Promise.all([t.appContext.getModel("person-models",t.ownerNsid),t.appContext.getModel("photo-models",t.photoId)]).then((e=>{t.set("personModel",e[0]),t.set("photoModel",e[1])})).catch((e=>{i.error("Error with fetching person models",{err:e})}))},setInterStitialType:function(){switch(this.appContext.flipper.isFlipped("enable-download-interstitial-upsell")){case"A":this.interStitialType="ad";break;case"B":this.interStitialType="giftPro";break;case"C":this.interStitialType="buyPro"}},buildContainer:function(){let t=this.get("personModel"),i=this.get("photoModel"),r=t.getValue("buddyicon").large?t.getValue("buddyicon").large:t.getValue("buddyicon").default,o=t.getValue("displayname"),n=t.getValue("nsid"),a=i.getPhotoLicenseInformation(),s=a?this.intlMessage({intlName:a.key}):"",l=e.URLHelper.generatePersonUrls(t);return this.setContainerWithTemplate("photo-page-download-interstitial",{version:this.interStitialType,displayName:o,pathAlias:l.profile,buddyIcon:r,nsid:n,license:s,learnMoreUrl:a?a.url:"",flickrProLogo:e.config.flickr.urls.assetRoot+"/images/pro/flickr-pro-h1-ic.png"}),this},activate:function(){let e=this.get("container"),t=e.one(".buy-pro-container");return t&&t.one(".butt")&&this.registerEventHandler(t.one(".butt").on("click",this.handleFlickrProClick.bind(this))),this.graphContainer=e.one(".progress-container .circular-progress-graph"),this.progressGraph=this.drawProgressGraph(),this.adCountdown(this.adTimerStartValue),this.progressGraph.start(),this},handleFlickrProClick:function(){e.config.win.location=e.url("/account/upgrade/pro")},adCountdown:function(e){let t=this,i=e,r=this.get("container");this.adInterval=setInterval((function(){i>=1?i-=1:(clearInterval(t.adInterval),t.fire("subviewViewEvent","timerEnded"),r.one(".progress-text-container").one(".text")&&(r.one(".progress-text-container").one(".text").getDOMNode().innerText=t.intlMessage({intlName:"photo-page-scrappy.DOWNLOAD_MODAL_COMPLETE"})))}),1e3)},drawProgressGraph:function(){return new e.CircleFillGraph({containerElement:this.graphContainer.getDOMNode(),dim:{width:35,height:35},lineWidth:4,backgroundStrokeColor:"#e1e1e1",gradient:[{fillProportion:0,value:"128fdc"},{fillProportion:1,value:"128fdc"}],duration:this.adTimerStartValue,stops:[{durationProportion:1,fillProportion:1,easeFunction:"linear"}],segments:120})},destructor:function(){this.progressGraph.stop(),this.progressGraph=null}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-download-interstitial","circle-fill-graph","url-helper","url"],optionalRequires:["hermes-core"],langBundles:["photo-page-scrappy","common","settings"]});YUI.add("hermes-lang-settings",(function(e,t){e.Intl.add("hermes/settings","en-US",{SAFE:[{type:0,value:"Safe"}],MODERATE:[{type:0,value:"Moderate"}],RESTRICTED:[{type:0,value:"Restricted"}],PUBLIC:[{type:0,value:"Public"}],PRIVATE:[{type:0,value:"Private"}],ANYONE:[{type:0,value:"Anyone"}],FRIENDS:[{type:0,value:"Friends"}],FAMILY:[{type:0,value:"Family"}],FRIENDS_AND_FAMILY:[{type:0,value:"Friends & Family"}],ONLY_YOU:[{type:0,value:"Only you"}],PEOPLE_YOU_FOLLOW:[{type:0,value:"People you follow"}],ANY_FLICKR_MEMBER:[{type:0,value:"Any Flickr member"}],SOME_RIGHTS_RESERVED:[{type:0,value:"Some rights reserved"}],ALL_RIGHTS_RESERVED:[{type:0,value:"All rights reserved"}],ATTRIBUTION:[{type:0,value:"Attribution"}],ATTRIBUTION_SHAREALIKE:[{type:0,value:"Attribution-ShareAlike"}],ATTRIBUTION_NODERIVS:[{type:0,value:"Attribution-NoDerivs"}],ATTRIBUTION_NONCOMMERCIAL:[{type:0,value:"Attribution-NonCommercial"}],ATTRIBUTION_NONCOMMERCIAL_SHAREALIKE:[{type:0,value:"Attribution-NonCommercial-ShareAlike"}],ATTRIBUTION_NONCOMMERCIAL_NODERIVS:[{type:0,value:"Attribution-NonCommercial-NoDerivs"}],NO_COPYRIGHT_RESTRICTIONS:[{type:0,value:"No known copyright restrictions"}],US_GOV_WORK:[{type:0,value:"United States government work"}],PUBLIC_DOMAIN_DEDICATION:[{type:0,value:"Public Domain Dedication (CC0)"}],PUBLIC_DOMAIN_WORK:[{type:0,value:"Public Domain Work"}],PRIVATE_PENDING_VIDEO:[{type:0,value:"Private while being processed"}],PRIVATE_FAILED_VIDEO:[{type:0,value:"Private because we couldn’t process this video"}],RESTRICTED_PHOTOS_ONLY:[{type:0,value:"Restricted — Photos only"}],SAFETY_LEVELS:[{type:0,value:"Safety levels"}],SAFE_DESC:[{type:0,value:"Acceptable to a global, public audience."}],MODERATE_DESC:[{type:0,value:"Partial nudity, like bare breasts and bottoms. This would include areolas, nipples, thongs, nipple covers/pasties, or see-through clothing of this nature."}],RESTRICTED_DESC:[{type:0,value:"Full-frontal nudity and sexual acts. This would include genitalia, pubic hair, full-frontal nudity, imagery depicting/insinuating sexual activity, gore, graphic violence, and adult themes. Videos cannot contain restricted content and are deleted if reported."}]})}),"@VERSION@",{requires:["intl"]});YUI.add("photo-engagement-view",(function(e,t){require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,t.showFaveCount=t.isResponsiveMobile,this.photoId=t.photoId,this.nsid=t.nsid,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.signinPendingQueue=t.signinPendingQueue,this.isResponsiveMobile=t.isResponsiveMobile,this.photoPrintsHelper=new e.PhotoPrintsHelper(this.appContext),this.signedIn=this.appContext.getViewer().signedIn,this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.curationHelper=new e.CurationHelper(this.appContext,{view:this}),this.downloadLink="",this.downloadInterstitialModal,t.subviewParams={"like-engagement-item-view":{photoId:t.photoId,showCount:!1,size:"medium",isPadded:!0}},this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0,additionalViewClasses:["engagement-item"],disabled:function(){return this.appContext.flipper.isFlipped("enable-likes")}},"like-engagement-item-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"],theme:"light",disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"]},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"],theme:"light"},"print-button-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"]}},loadState:function(){return this.appContext.getModel("photo-models",this.photoId).then((e=>{var t=e.getValue("owner");return this.set("photo",e),this.downloadButtonEnabled=!1,e.getValue("isVideo")?(this.appContext.flipper.isFlipped("disable-video-playback")?this.downloadButtonEnabled=!1:(this.appContext.flipper.isFlipped("enable-album-download")&&(this.downloadButtonEnabled=e.getValue("engagement").getValue("canDownload")),t.getValue("isMe")&&(this.downloadButtonEnabled=!0)),this.downloadLink="/video_download.gne?id="+e.getValue("id")):(this.downloadButtonEnabled=!0,this.downloadLink=e.getValue("url")+"/sizes/l/"),this.appContext.getModel("person-relationship-models",e.getValue("owner").getValue("nsid"))})).then((e=>{this.set("relationshipModel",e)}))},buildContainer:function(){var e,t=this.get("photo"),o=t.getValue("owner"),n=this.get("container"),i=this.photoCardHelper.convertPhotoModel(t);return e={"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):"",photoId:t.getValue("id"),ownerId:t.getValue("owner").getValue("id"),isVideo:t.getValue("isVideo"),viewerIsOwner:o.getValue("isMe"),downloadingAvailable:this.downloadButtonEnabled,downloadLink:this.downloadLink,showPrintButton:this.photoPrintsHelper.canPrintPhoto(t,this.get("relationshipModel")),photoItem:i,signedIn:this.signedIn,faveCount:t.getValue("engagement").getValue("faveCount"),commentCount:t.getValue("engagement").getValue("commentCount"),isResponsiveMobile:this.isResponsiveMobile},this.appContext.forceServerRender&&(e.downloadItems=this.getDownloadMenuItems()),this.setContainerWithTemplate("photo-engagement",e),this.isResponsiveMobile&&n.addClass("responsive-mobile"),this},activate:function(){var t=this,o=(this.get("photo").getValue("license"),this.get("container"));if(this.engagementModel=this.get("photo").getValue("engagement"),this.signinPendingQueue&&this.signinPendingQueue.length>0)for(var n=this.signinPendingQueue,i=0;i<n.length;i++)"download"===n[i].key&&n[i].value&&n[i].value.id===this.photoId&&this.downloadItem(n[i].value.imageUrl);return this.engagementModel.getValue("canDownload")&&this.registerEventHandler(e.one("body").delegate("click",(function(e){let o=t.appContext.viewportData.getWidth();window&&window.innerWidth&&window.innerWidth!==o&&(o+=t.appContext.viewportData.scrollbarWidth),o&&o>700&&t.appContext.flipper.isFlipped("enable-download-interstitial-upsell")?t.showDownloadIntersitialModal(e):t.handleDownloadItemClick(e)}),".sizes li a.download-image-size")),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(o.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.curateNode=o.one(".engagement-item.curate"),this.curateNode&&this.registerEventHandler(this.curateNode.on("click",this.handleCurateClick.bind(this))),this.commentNode=o.one(".engagement-item.comment"),this.commentNode&&(this.commentTextNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on("click",this.showCommentsModal.bind(this)))),this.faveTextNode=o.one(".fave-count"),this.registerEventHandler(this.engagementModel.on("valuesChanged",this.handleEngagementModelValuesChanged.bind(this))),this},showDownloadIntersitialModal:function(t){let o=this;t.preventDefault(),this.downloadInterstitialModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!1,showCancelButton:!1,showFooter:!1,showCancelX:!0,subview:new e.Views["photo-page-download-interstitial-view"]({appContext:o.appContext,nsid:this.nsid,photoId:this.photoId}),width:900,minWidth:650,height:540,fullWindow:!1,classList:"download-interstitial-modal"}),this.downloadInterstitialModal.show(),this.downloadInterstitialModal.on("timerEnded",(function(){o.handleDownloadItemClick(t)})),this.downloadInterstitialModal.on("close",(function(){o.downloadMenu&&(o.downloadMenu.close(),o.downloadMenu=null)}))},getDownloadMenuItems:function(t){var o,n=this.get("photo"),i=e.clone(n.getValue("sizes")),a=[],s=n.getValue("engagement").getValue("canDownload"),l=this;for(["q","sq"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),a.push(i[e])})),["w","n","s","t"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.SMALL"}),a.push(i[e])})),["c","z","m"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),a.push(i[e])})),["k","h","l"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.LARGE"}),a.push(i[e])})),["6k","5k","4k","3k"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"common.XLARGE"}),a.push(i[e])})),i.o&&(i.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),a.push(i.o)),o=0;o<a.length;o++)a[o].url=a[o].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");return this.templates("scrappy-download-menu")({photoURL:n.getValue("url"),sizes:a,showDownloadSizes:s})},createDownloadDialog:function(t){var o=this.get("container");this.downloadMenu&&(this.downloadMenu.close(),this.downloadMenu=null),this.downloadMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetVertical:5,width:200,anchorElement:o.one(".download"),htmlMessage:t,closeOnScroll:!1,classList:"download-dialog-tooltip",autoSizeToContent:!0}),this.downloadMenu.show()},handleDownloadMenuButtonClick:function(e){var t=this.get("photo");if(this.downloadButtonEnabled)if(t.getValue("isVideo")){if(this.appContext.flipper.isFlipped("enable-album-download"))e.preventDefault(),this.downloadItem(this.downloadLink);else if(!t.getValue("owner").getValue("isMe"))return e.preventDefault(),!1}else e.halt(),this.createDownloadDialog(this.getDownloadMenuItems());else e.preventDefault()},handleDownloadItemClick:function(t){t.preventDefault(),this.downloadItem(t.currentTarget.getAttribute("href"));let o=t.currentTarget;if(o){let t=o.getAttribute("data-size"),n=o.getAttribute("data-res-width"),i=o.getAttribute("data-res-height");t&&n&&i&&e.Snowplough.sendSelfDescribingEvent({schema:e.Snowplough.SCHEMAS.DOWNLOAD,data:{photoId:[parseInt(this.get("photo").getValue("id"),10)],size:t.toLowerCase(),width:parseInt(n,10),height:parseInt(i,10),license:parseInt(this.get("photo").getValue("license"),10),ownerNsid:this.get("photo").getValue("owner").id,isBatch:!1}},e.Snowplough.getPhotoContextFromModel(this.get("photo")))}!this.appContext.flipper.isFlipped("enable-download-interstitial-upsell")&&this.downloadMenu&&(this.downloadMenu.close(),this.downloadMenu=null)},downloadItem:function(e){document.location=e},handleCurateClick:function(){var t=this,o=this.get("photo").getValue("isOwner");"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.get("photo").getValue("id"),showAlbums:o,showGalleries:!o,anchorNode:this.curateNode}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",(function(){t.fire("menuClosed"),t.curateNode.removeClass("active")})),this.curateNode.addClass("active")),e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"curateClick"},e.Snowplough.getPhotoContextFromModel(this.get("photo")))},showCommentsModal:function(){var t={appContext:this.appContext,photoId:this.photoId,isScrollable:!0,hasHeader:!0},o=new e.ModalDroparoundHelper(this.appContext,{useViewportType:!1,containerType:"modal",configs:{common:{subviewName:"photo-comments-view",subviewParams:t},modal:{height:550,flexLayout:!0}}});this.registerEventHandler(o.on("close",(()=>{e.fire("photoCommentModalClosed",{photoId:this.photoId})}))),this.registerEventHandler(e.on("addComment:showingSignupModal",(()=>{o.close()}))),o.show()},handleEngagementModelValuesChanged:function(t){var o,n;t.commentCount?(o=t.commentCount.newVal,this.commentTextNode&&(this.commentTextNode.set("text",e.IntlNumber.format(o,this.appContext.lang,1)),this.commentTextNode.toggleClass("hidden",0===o))):t.faveCount&&(n=t.faveCount.newVal,this.faveTextNode&&(this.faveTextNode.set("text",e.IntlNumber.format(n,this.appContext.lang,1)),this.faveTextNode.toggleClass("hidden",0===n)))}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-scrappy-download-menu","signup-modal-view","fluid-share-photo-view","fluid-droparound-view","print-button-view","photo-comments-view","better-throttle","photo-prints-helper","photo-card-helper","fluid-modal-view","photo-page-download-interstitial-view"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["common","photo-page-scrappy","comments"]});YUI.add("flickr-route",(function(r,e){var t=require("hermes-core/flog")(e),i=require("hermes-core/type-validator");r.Routes=r.Routes||{},r.FlickrRoute=function(r){this.appContext=r},r.FlickrRoute.prototype={run:function(){},setRouteDataOnHistory:function(e,t){return r.HistoryHelper.setData(this.name,e,t)},getRouteDataFromHistory:function(e){return r.HistoryHelper.getData(this.name,e)},getRouteMetaValue:function(r,e){return this.appContext.routeConfig.meta?e?this.appContext.routeConfig.meta[r]?this.appContext.routeConfig.meta[r]:e:this.appContext.routeConfig.meta[r]?this.appContext.routeConfig.meta[r]:null:null},displayServerErrorOrClientRedirect:function(e,t,i){return YUI.Env.isServer?this.displayRouteErrors(e,new r.RouteError(404,t)):r.Promise.resolve({redirect:i||e.url})},detectRouteErrors:function(){var e=r.Array(arguments);return e.filter((function(e,t){return e instanceof r.RouteError})).sort((function(r,e){return r.type-e.type}))},displayRouteErrors:function(e,t){var i=r.Lang.isArray(t)?t[0]:t;return r.Promise.resolve(this["display"+i.type+"Error"](e,i))},display500Error:function(e,i){var a,s,o;return a={view:"error-500-page-view",params:{},headers:{statusCode:500}},(r.config.flickr.error.show_debugging_info||e.isPossiblyAdminUser||this.appContext&&this.appContext.auth&&this.appContext.auth.isPossiblyAdminUser)&&(a.params.source="flickrRoute#display500Error",a.params.message=i.message,a.params.stack=i.stack,a.params.apiMethod=i.apiMethod),YUI.Env.isServer||(a.params.message=i.message,a.params.apiMethod=i.apiMethod),e.id&&(a.params.requestID=e.id),i&&"SiteAuth"===i.type&&(i.redirect?(s=YUI.Env.isServer?e.protocol+"://"+e.hostname+e.originalUrl:e.url,o=r.url("/siteauth/?redirect_url="+encodeURIComponent(s)),YUI.Env.isServer&&t.info("Redirecting to siteauth"),a={redirect:o}):YUI.Env.isServer&&(a.params.siteAuthFailure=!0)),void 0===a.redirect?t.info("render",{status:500,req:e,err:i,isBot:this.appContext.getUA().isBot}):t.info("redirect",{status:302,req:e,location:a.redirect,isBot:this.appContext.getUA().isBot}),a},display303Error:function(r,e){return{redirect:e.options.redirect,headers:{statusCode:303}}},display403Error:function(r,e){return this.displayStandardErrorPage(r,e,403)},display404Error:function(r,e){return e=e||new Error("404"),t.info("render",{status:404,url:r.url,err:e,isBot:this.appContext.getUA().isBot}),this.displayStandardErrorPage(r,e,404)},display410Error:function(r,e){return this.displayStandardErrorPage(r,e,410)},displayStandardErrorPage:function(e,t,i){var a;return t=t||{},a={view:"fluid-error-page-view",params:{statusCode:i,url:e.url,message:t.message,catchAll:t.catchAll||!1},headers:{statusCode:i}},t.data&&(a.params=r.merge(a.params,t.data)),(r.config.flickr.error.show_debugging_info||e.isPossiblyAdminUser||this.appContext&&this.appContext.auth&&this.appContext.auth.isPossiblyAdminUser)&&(a.params.source="flickrRoute#display"+i+"Error",a.params.message=t.message),e.id&&(a.params.requestID=e.id),a},getPageNumber:function(r,e){var t=parseInt(r.params[e||"page_number"],10);return(isNaN(t)||t<=1)&&(t=1),t},getNSIDOrPathAlias:function(r){var e;return i.nsid(r)?e=r:i.pathAlias(r)?e={pathAlias:r}:t.warn("Couldn't identify "+r+" as an nsid or path alias."),e}},r.RouteError=function(r,e,t){this.type=r,this.message=e||"",this.data=t||{}}}),"@VERSION@",{requires:["flickr-promise","moment","url","history-helper"],optionalRequires:["hermes-core"]});YUI.add("seo",(function(e,t){e.Seo={appContext:{},stripTags:function(e){return e?String(e).replace(/<\/?[^>]+>/g,""):""},collapseWhitespace:function(e){return e.trim().replace(/\s+/g," ")},decodeEntities:function(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")},cleanText:function(e){return this.collapseWhitespace(this.decodeEntities(this.stripTags(e)))},getSEOTitleForPhoto:function(e){var t=this.cleanText(e.getValue("title")),l=this.cleanText(e.getValue("description")),n=this.cleanText(e.getValue("owner").getValue("displayname")),g=70-(t.length+"| Flickr".length+5);return t.length>=50?t.slice(0,58)+(t.length<58?" ":"… "):t.length>20&&t.length<50?l.length>20?t+" | "+l.slice(0,g)+(l.length<g?" ":"… "):l.length>0?t+" | "+l.slice(0,g)+(l.length<g?" ":"… ")+"| "+n+" ":t+" | "+n+" ":t.length<=20&&t.length>0?l.length>50?t+" | "+l.slice(0,g)+(l.length<g?" ":"… "):l.length>0?t+" | "+l.slice(0,g)+(l.length<g?" ":"… ")+"| "+n+" ":t+" | "+n+" ":l.length>50?l.slice(0,g)+(l.length<g?" ":"… "):l.length>0?l.slice(0,g)+(l.length<g?" ":"… ")+"| "+n+" ":"Untitled | "+n+" "},generateSEODescriptionForPhoto:function(e,t,l,n,g){var i=e.getValue("og:title"),h=e.getValue("og:description"),c="";return"Untitled"===i&&(i=n),h.length>120?c=h.slice(0,120)+(h.length<120?" ":"… ")+l+" "+g+".":h.length>60&&h.length<120?c=h+("."===h.slice(h.length-1,h.length)?" ":". ")+i.slice(0,40)+(i.length<40?" ":"… ")+l+" "+g+".":h.length<=60&&(c=i+("."===i.slice(i.length-1,i.length)?" ":". ")+h.slice(0,160-i.length)+(h.length<160-i.length?" ":"… ")+l+" "+g+"."),c}}}),"@VERSION@",{requires:[]});